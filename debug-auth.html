<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Authentication</title>
</head>
<body>
    <h1>Authentication Debug</h1>
    <button onclick="clearSession()">Clear Session</button>
    <button onclick="testAuth()">Test Auth</button>
    <button onclick="simulateAuth()">Simulate Auth</button>
    <div id="status"></div>
    <div id="test-content" style="display: none;">
        <h2>Protected Content</h2>
        <p>This content should only be visible after authentication.</p>
    </div>

    <script>
        const VALID_USERNAME = 'admin';
        const VALID_PASSWORD = 'PrecisionAdmin2025!';
        const SESSION_KEY = 'precision_auth_session';
        const PAGE_ACCESS_KEY = 'precision_page_access';

        function clearSession() {
            sessionStorage.removeItem(SESSION_KEY);
            sessionStorage.removeItem(PAGE_ACCESS_KEY);
            document.getElementById('status').innerHTML = '<p style="color: red;">Session cleared</p>';
            document.getElementById('test-content').style.display = 'none';
        }

        function testAuth() {
            const session = sessionStorage.getItem(SESSION_KEY);
            const pageAccess = sessionStorage.getItem(PAGE_ACCESS_KEY);
            
            console.log('Debug - Authentication check:', {
                session: session,
                pageAccess: pageAccess
            });
            
            document.getElementById('status').innerHTML = `
                <h2>Authentication Status:</h2>
                <p><strong>Session:</strong> ${session || 'null'}</p>
                <p><strong>Page Access:</strong> ${pageAccess || 'null'}</p>
                <p><strong>Is Authenticated:</strong> ${session === 'authenticated' ? 'Yes' : 'No'}</p>
                <p><strong>Check Result:</strong> ${checkAuthentication() ? 'PASS' : 'FAIL'}</p>
            `;
        }

        function simulateAuth() {
            sessionStorage.setItem(SESSION_KEY, 'authenticated');
            sessionStorage.setItem(PAGE_ACCESS_KEY, 'debug');
            document.getElementById('status').innerHTML = '<p style="color: green;">Authentication simulated</p>';
            document.getElementById('test-content').style.display = 'block';
        }

        function checkAuthentication() {
            const session = sessionStorage.getItem(SESSION_KEY);
            
            console.log('checkAuthentication called:', {
                session: session,
                isAuthenticated: session === 'authenticated'
            });
            
            if (!session || session !== 'authenticated') {
                console.log('Authentication failed, should show modal');
                showLoginModal();
                return false;
            }
            
            console.log('Authentication passed');
            return true;
        }

        function showLoginModal() {
            console.log('showLoginModal called');
            alert('Authentication required! (This is a test modal)');
        }

        // Test on load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, clearing session first');
            
            // FORCE clear session to test authentication
            sessionStorage.removeItem(SESSION_KEY);
            sessionStorage.removeItem(PAGE_ACCESS_KEY);
            
            console.log('Session cleared, testing authentication');
            testAuth();
            
            if (!checkAuthentication()) {
                console.log('Authentication check failed - GOOD!');
                return;
            }
            
            console.log('Authentication check passed - BAD! Should have failed');
            document.getElementById('test-content').style.display = 'block';
        });
    </script>
</body>
</html>
