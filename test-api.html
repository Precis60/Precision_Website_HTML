<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Test</title>
    <script src="config.js"></script>
    <script src="data-manager.js"></script>
</head>
<body>
    <h1>API Connection Test</h1>
    <div id="results"></div>

    <script>
        async function testAPI() {
            const results = document.getElementById('results');
            
            // Debug CONFIG loading
            console.log('CONFIG:', typeof CONFIG !== 'undefined' ? CONFIG : 'CONFIG not defined');
            
            let dataManager;
            try {
                const useOnlineStorage = typeof CONFIG !== 'undefined' && CONFIG.USE_ONLINE_STORAGE;
                console.log('Using online storage:', useOnlineStorage);
                dataManager = new DataManager(useOnlineStorage);
                console.log('DataManager initialized successfully');
                console.log('API Base URL:', dataManager.apiBaseUrl);
            } catch (error) {
                console.error('Failed to initialize DataManager:', error);
                dataManager = new DataManager(false);
            }
            
            try {
                // Test getting contacts
                console.log('Testing contacts...');
                const contacts = await dataManager.getContacts();
                console.log('Contacts:', contacts);
                
                // Test getting events  
                console.log('Testing events...');
                const events = await dataManager.getEvents();
                console.log('Events:', events);
                
                // Test getting login details
                console.log('Testing login details...');
                const loginDetails = await dataManager.getLoginDetails();
                console.log('Login Details:', loginDetails);
                
                results.innerHTML = `
                    <h2>API Test Results:</h2>
                    <p><strong>DataManager URL:</strong> ${dataManager.apiBaseUrl}</p>
                    <p><strong>Using API:</strong> ${dataManager.useAPI}</p>
                    
                    <h3>Contacts (${contacts.length}):</h3>
                    <pre>${JSON.stringify(contacts, null, 2)}</pre>
                    
                    <h3>Events (${events.length}):</h3>
                    <pre>${JSON.stringify(events, null, 2)}</pre>
                    
                    <h3>Login Details (${loginDetails.length}):</h3>
                    <pre>${JSON.stringify(loginDetails, null, 2)}</pre>
                `;
                
            } catch (error) {
                console.error('Error testing API:', error);
                results.innerHTML = `<p style="color: red;">Error: ${error.message}</p>
                                  <p><strong>Error Stack:</strong></p>
                                  <pre>${error.stack}</pre>`;
            }
        }
        
        // Run test when page loads
        testAPI();
    </script>
</body>
</html>
